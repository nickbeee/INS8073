 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 1 - 01/27/23 00:33:42


       1/       0 :                     ;;;
       2/       0 :                     ;;; Universal Monitor INS8070 (SC/MP III)
       3/       0 :                     ;;;   Copyright (C) 2021  Haruo Asano
       4/       0 :                     ;;;
       5/       0 :                     
       6/       0 :                     	CPU	8070
       7/       0 :                     
       8/       0 :                     
       9/       0 :                     	INCLUDE	"config.inc"
(1)    1/       0 :                     ;;; -*- asm -*-
(1)    2/       0 :                     ;;;
(1)    3/       0 :                     ;;; Universal Monitor INS8070 config file (INS8073 with default software UART)
(1)    4/       0 :                     ;;;
(1)    5/       0 :                     
(1)    6/       0 :                     ;;;
(1)    7/       0 :                     ;;; Memory
(1)    8/       0 :                     ;;;
(1)    9/       0 :                     
(1)   10/       0 : =0xF000              ROM_B:	EQU	0xF000
(1)   11/       0 : =0x1800              RAM_B:	EQU	0x1800
(1)   12/       0 : =0x1FC0              WORK_B:	equ	0x1FC0
(1)   13/       0 : =0x1F00              STACK:	equ	0x1F00
(1)   14/       0 :                     
(1)   15/       0 : =0x10                BUFLEN:	equ	16
(1)   16/       0 :                     
(1)   17/       0 :                     ;;;
(1)   18/       0 :                     ;;; Options
(1)   19/       0 :                     ;;;
(1)   20/       0 :                     
(1)   21/       0 : =0x1                 USE_REGCMD = 1			; R(egister) command and related functions
(1)   22/       0 :                     
(1)   23/       0 : =0x1                 FOR_INS8073 = 1			; Called from BASIC (do not initialize SP)
(1)   24/       0 :                     
(1)   25/       0 : =0x0                 CONSOLE_FOR_BASIC = 0		; Make BASIC use dev/dev_xxxx as console
(1)   26/       0 :                     	
(1)   27/       0 :                     ;;;
(1)   28/       0 :                     ;;; EMILY Board (Shared Memory)
(1)   29/       0 :                     ;;; 
(1)   30/       0 :                     
(1)   31/       0 : =0x0                 USE_DEV_EMILY = 0
(1)   32/       0 : =>FALSE              	IF USE_DEV_EMILY
(1)   33/       0 :                     SMBASE:	EQU	0x1FF0
(1)   34/       0 : [32]                 	ENDIF
(1)   35/       0 :                     
(1)   36/       0 :                     ;;;
(1)   37/       0 :                     ;;; INS8073  (Call routine in NSC Tiny BASIC ROM)
(1)   38/       0 :                     ;;;
(1)   39/       0 :                     
(1)   40/       0 : =0x1                 USE_DEV_INS8073 = 1
(1)   41/       0 : =>TRUE               	IF USE_DEV_INS8073
(1)   42/       0 : =0x1                 MEMREQ = 1
(1)   43/       0 : [41]                 	ENDIF
(1)   44/       0 :                     
      10/       0 :                     
      11/       0 :                     	INCLUDE	"../common.inc"
(1)    1/       0 :                     ;;; -*- asm -*-
(1)    2/       0 :                     ;;;
(1)    3/       0 :                     ;;; Common header file
(1)    4/       0 :                     ;;;
(1)    5/       0 :                     
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm(common.inc) - Page 2 - 01/27/23 00:33:42


(1)    6/       0 :                     	RELAXED	ON
(1)    7/       0 :                     
(1)    8/       0 :                     ;;; Constants
(1)    9/       0 : =0xD                 CR:	EQU	0x0D
(1)   10/       0 : =0xA                 LF:	EQU	0x0A
(1)   11/       0 : =0x8                 BS:	EQU	0x08
(1)   12/       0 : =0x7F                DEL:	EQU	0x7F
(1)   13/       0 :                     
(1)   14/       0 :                     ;;; Functions
(1)   15/       0 :                     low	function	x,(x & 255)
(1)   16/       0 :                     high	function	x,(x >> 8)
(1)   17/       0 :                     
(1)   18/       0 :                     	RELAXED	OFF
(1)   19/       0 :                     
      12/       0 :                     
      13/       0 :                     ;;;
      14/       0 :                     ;;; ROM	area
      15/       0 :                     ;;;
      16/       0 :                     
      17/    F000 :                     	ORG	ROM_B
      18/    F000 :                     	
      19/    F000 : 00                  	NOP			; Dummy
      20/    F001 : 24 03 F0            	JMP	CSTART		; Reset
      21/    F004 :                     
      22/    F004 : =>FALSE              	IF ROM_B = 0x0000
      23/    F004 :                     	;; Fixed address area
      24/    F004 :                     	JMP	DUMMY		; INTA
      25/    F004 :                     	JMP	DUMMY		; INTB
      26/    F004 :                     
      27/    F004 :                     	;; CALL vector
      28/    F004 :                     	ORG	0x0020
      29/    F004 :                     	
      30/    F004 :                     	DW	DUMMY-1		; CALL 0
      31/    F004 :                     	DW	DUMMY-1
      32/    F004 :                     	DW	DUMMY-1
      33/    F004 :                     	DW	DUMMY-1
      34/    F004 :                     
      35/    F004 :                     	DW	DUMMY-1		; CALL 4
      36/    F004 :                     	DW	DUMMY-1
      37/    F004 :                     	DW	DUMMY-1
      38/    F004 :                     	DW	DUMMY-1
      39/    F004 :                     
      40/    F004 :                     	DW	DUMMY-1		; CALL 8
      41/    F004 :                     	DW	DUMMY-1
      42/    F004 :                     	DW	DUMMY-1
      43/    F004 :                     	DW	DUMMY-1
      44/    F004 :                     
      45/    F004 :                     	DW	DUMMY-1		; CALL 12
      46/    F004 :                     	DW	DUMMY-1
      47/    F004 :                     	DW	DUMMY-1
      48/    F004 :                     	DW	BREAK-1		; BREAK
      49/    F004 :                     
      50/    F004 :                     	ORG	0x0040		; Skip vector for CALL instruction
      51/    F004 : [22]                 	ENDIF
      52/    F004 :                     
      53/    F004 :                     CSTART:
      54/    F004 : =>FALSE              	IF ~~FOR_INS8073
      55/    F004 :                     	LD	SP,=STACK
      56/    F004 : [54]                 	ENDIF
      57/    F004 :                     
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 3 - 01/27/23 00:33:42


      58/    F004 : 20 7D F7            	JSR	INIT
      59/    F007 :                     
      60/    F007 : 27 C0 1F            	LD	P3,=WORK
      61/    F00A : 84 00 18            	LD	EA,=RAM_B
      62/    F00D : 8B 10               	ST	EA,W_DSADDR,P3
      63/    F00F : 8B 17               	ST	EA,W_SADDR,P3
      64/    F011 : 8B 15               	ST	EA,W_GADDR,P3
      65/    F013 :                     
      66/    F013 : =>TRUE               	IF USE_REGCMD
      67/    F013 : 8B 24               	ST	EA,W_REGPC,P3
      68/    F015 : 31                  	LD	EA,SP
      69/    F016 : 8B 26               	ST	EA,W_REGSP,P3
      70/    F018 : 84 00 00            	LD	EA,=0x0000
      71/    F01B : 8B 1F               	ST	EA,W_REGEA,P3
      72/    F01D : 8B 21               	ST	EA,W_REGT,P3
      73/    F01F : 8B 28               	ST	EA,W_REGP2,P3
      74/    F021 : 8B 2A               	ST	EA,W_REGP3,P3
      75/    F023 : CB 23               	ST	A,W_REGS,P3
      76/    F025 : [66]                 	ENDIF			; USE_REGCMD
      77/    F025 :                     
      78/    F025 : C4 49               	LD	A,='I'
      79/    F027 : CB 19               	ST	A,W_HEXMOD,P3
      80/    F029 :                     
      81/    F029 :                     	;; Opening message
      82/    F029 : 26 61 F6            	LD	P2,=OPNMSG
      83/    F02C : 20 1D F5            	JSR	STROUT
      84/    F02F :                     
      85/    F02F :                     WSTART:
      86/    F02F : 26 7F F6            	LD	P2,=PROMPT
      87/    F032 : 20 1D F5            	JSR	STROUT
      88/    F035 : 20 83 F5            	JSR	GETLIN
      89/    F038 : 26 C0 1F            	LD	P2,=WORK_INBUF
      90/    F03B : 20 E0 F5            	JSR	SKIPSP
      91/    F03E : 20 E9 F5            	JSR	UPPER
      92/    F041 : 6C EC               	BZ	WSTART
      93/    F043 : 48                  	LD	E,A		; backup A
      94/    F044 :                     
      95/    F044 : FC 44               	SUB	A,='D'
      96/    F046 : 7C 03               	BNZ	M00
      97/    F048 : 24 81 F0            	JMP	DUMP
      98/    F04B :                     M00:
      99/    F04B : 40                  	LD	A,E
     100/    F04C : FC 47               	SUB	A,='G'
     101/    F04E : 7C 03               	BNZ	M01
     102/    F050 : 24 9D F1            	JMP	GO
     103/    F053 :                     M01:
     104/    F053 : 40                  	LD	A,E
     105/    F054 : FC 53               	SUB	A,='S'
     106/    F056 : 7C 03               	BNZ	M02
     107/    F058 : 24 D2 F1            	JMP	SETM
     108/    F05B :                     M02:
     109/    F05B : 40                  	LD	A,E
     110/    F05C : FC 4C               	SUB	A,='L'
     111/    F05E : 7C 03               	BNZ	M03
     112/    F060 : 24 4E F2            	JMP	LOADH
     113/    F063 :                     M03:
     114/    F063 : 40                  	LD	A,E
     115/    F064 : FC 50               	SUB	A,='P'
     116/    F066 : 7C 03               	BNZ	M04
     117/    F068 : 24 3C F3            	JMP	SAVEH
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 4 - 01/27/23 00:33:42


     118/    F06B :                     M04:
     119/    F06B : =>TRUE               	IF USE_REGCMD
     120/    F06B : 40                  	LD	A,E
     121/    F06C : FC 52               	SUB	A,='R'
     122/    F06E : 7C 03               	BNZ	M05
     123/    F070 : 24 4B F4            	JMP	REG
     124/    F073 :                     M05:
     125/    F073 : [119]                	ENDIF			; USE_REGCMD
     126/    F073 :                     
     127/    F073 : =>TRUE               	IF FOR_INS8073
     128/    F073 : 40                  	LD	A,E
     129/    F074 : FC 51               	SUB	A,='Q'
     130/    F076 : 7C 01               	BNZ	M09
     131/    F078 : 5C                  	RET
     132/    F079 :                     M09:
     133/    F079 : [127]                	ENDIF
     134/    F079 :                     
     135/    F079 :                     ERR:
     136/    F079 : 26 9C F6            	LD	P2,=ERRMSG
     137/    F07C : 20 1D F5            	JSR	STROUT
     138/    F07F : 24 2E F0            	JMP	WSTART
     139/    F082 :                     
     140/    F082 :                     ;;; Dump memory
     141/    F082 :                     
     142/    F082 :                     DUMP:
     143/    F082 : C6 01               	LD	A,@1,P2		; INC P2
     144/    F084 : 20 E0 F5            	JSR	SKIPSP
     145/    F087 : 20 FB F5            	JSR	RDHEX
     146/    F08A : C3 1C               	LD	A,W_CNT,P3
     147/    F08C : 7C 10               	BNZ	DP0
     148/    F08E :                     	;; No arg.
     149/    F08E : 20 E0 F5            	JSR	SKIPSP
     150/    F091 : C2 00               	LD	A,0,P2
     151/    F093 : 7C E4               	BNZ	ERR
     152/    F095 :                     DP00:
     153/    F095 : 83 10               	LD	EA,W_DSADDR,P3
     154/    F097 : B4 80 00            	ADD	EA,=128
     155/    F09A : 8B 12               	ST	EA,W_DEADDR,P3
     156/    F09C : 74 32               	BRA	DPM
     157/    F09E :                     	;; 1st arg. found
     158/    F09E :                     DP0:
     159/    F09E : 83 1A               	LD	EA,W_VAL,P3
     160/    F0A0 : 8B 10               	ST	EA,W_DSADDR,P3
     161/    F0A2 : 20 E0 F5            	JSR	SKIPSP
     162/    F0A5 : C2 00               	LD	A,0,P2
     163/    F0A7 : FC 2C               	SUB	A,=','
     164/    F0A9 : 6C 06               	BZ	DP1
     165/    F0AB : C2 00               	LD	A,0,P2
     166/    F0AD : 6C E6               	BZ	DP00		; No 2nd arg.
     167/    F0AF : 74 C8               	BRA	ERR
     168/    F0B1 :                     	;;
     169/    F0B1 :                     DP1:
     170/    F0B1 : C6 01               	LD	A,@1,P2
     171/    F0B3 : 20 E0 F5            	JSR	SKIPSP
     172/    F0B6 : 20 FB F5            	JSR	RDHEX
     173/    F0B9 : 20 E0 F5            	JSR	SKIPSP
     174/    F0BC : C3 1C               	LD	A,W_CNT,P3
     175/    F0BE : 6C 0D               	BZ	DP1E
     176/    F0C0 : C2 00               	LD	A,0,P2
     177/    F0C2 : 7C 09               	BNZ	DP1E
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 5 - 01/27/23 00:33:42


     178/    F0C4 : 83 1A               	LD	EA,W_VAL,P3
     179/    F0C6 : B4 01 00            	ADD	EA,=1
     180/    F0C9 : 8B 12               	ST	EA,W_DEADDR,P3
     181/    F0CB : 74 03               	BRA	DPM
     182/    F0CD :                     DP1E:
     183/    F0CD : 24 78 F0            	JMP	ERR
     184/    F0D0 :                     DPM:
     185/    F0D0 : 83 10               	LD	EA,W_DSADDR,P3
     186/    F0D2 : D4 F0               	AND	A,=0xF0
     187/    F0D4 : 46                  	LD	P2,EA
     188/    F0D5 : C4 00               	LD	A,=0
     189/    F0D7 : CB 14               	ST	A,W_DSTATE,P3
     190/    F0D9 :                     DPM0:
     191/    F0D9 : 20 FA F0            	JSR	DPL
     192/    F0DC : 20 8A F7            	JSR	CONST
     193/    F0DF : FC 01               	SUB	A,=1
     194/    F0E1 : 6C 0F               	BZ	DPM1
     195/    F0E3 : C3 14               	LD	A,W_DSTATE,P3
     196/    F0E5 : FC 02               	SUB	A,=2
     197/    F0E7 : 64 02               	BP	DPM01
     198/    F0E9 : 74 EE               	BRA	DPM0
     199/    F0EB :                     DPM01:
     200/    F0EB :                     	;; Finish
     201/    F0EB : 83 12               	LD	EA,W_DEADDR,P3
     202/    F0ED : 8B 10               	ST	EA,W_DSADDR,P3
     203/    F0EF : 24 2E F0            	JMP	WSTART
     204/    F0F2 :                     DPM1:
     205/    F0F2 :                     	;; Abort
     206/    F0F2 : 32                  	LD	EA,P2
     207/    F0F3 : 8B 10               	ST	EA,W_DSADDR,P3
     208/    F0F5 : 20 7E F7            	JSR	CONIN
     209/    F0F8 : 24 2E F0            	JMP	WSTART
     210/    F0FB :                     
     211/    F0FB :                     	;; Dump line
     212/    F0FB :                     DPL:
     213/    F0FB : 32                  	LD	EA,P2
     214/    F0FC : 0A                  	PUSH	A
     215/    F0FD : 40                  	LD	A,E
     216/    F0FE : 20 27 F5            	JSR	HEXOUT2
     217/    F101 : 38                  	POP	A
     218/    F102 : 20 27 F5            	JSR	HEXOUT2
     219/    F105 : 22 A4 F6            	PLI	P2,=DSEP0
     220/    F108 : 20 1D F5            	JSR	STROUT
     221/    F10B : 5E                  	POP	P2
     222/    F10C :                     
     223/    F10C : 84 C0 1F            	LD	EA,=WORK_INBUF
     224/    F10F : 8B 1A               	ST	EA,W_VAL,P3
     225/    F111 : C4 10               	LD	A,=16
     226/    F113 : CB 1C               	ST	A,W_CNT,P3
     227/    F115 :                     DPL0:
     228/    F115 : 20 46 F1            	JSR	DPB
     229/    F118 : 9B 1C               	DLD	A,W_CNT,P3
     230/    F11A : 7C F9               	BNZ	DPL0
     231/    F11C :                     
     232/    F11C : 22 A7 F6            	PLI	P2,=DSEP1
     233/    F11F : 20 1D F5            	JSR	STROUT
     234/    F122 : 5E                  	POP	P2
     235/    F123 :                     
     236/    F123 :                     	;; Print ASCII area
     237/    F123 : 22 C0 1F            	PLI	P2,=WORK_INBUF
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 6 - 01/27/23 00:33:42


     238/    F126 : C4 10               	LD	A,=16
     239/    F128 : CB 1C               	ST	A,W_CNT,P3
     240/    F12A :                     DPL1:
     241/    F12A : C6 01               	LD	A,@1,P2
     242/    F12C : FC 20               	SUB	A,=' '
     243/    F12E : 64 04               	BP	DPL3
     244/    F130 :                     DPL2:
     245/    F130 :                     	;; Unprintable
     246/    F130 : C4 2E               	LD	A,='.'
     247/    F132 : 74 08               	BRA	DPL4
     248/    F134 :                     DPL3:
     249/    F134 : C2 FF               	LD	A,-1,P2
     250/    F136 : FC 7F               	SUB	A,=0x7F
     251/    F138 : 64 F6               	BP	DPL2
     252/    F13A : C2 FF               	LD	A,-1,P2
     253/    F13C :                     DPL4:
     254/    F13C : 20 8D F7            	JSR	CONOUT
     255/    F13F : 9B 1C               	DLD	A,W_CNT,P3
     256/    F141 : 7C E7               	BNZ	DPL1
     257/    F143 :                     
     258/    F143 : 5E                  	POP	P2
     259/    F144 : 24 79 F5            	JMP	CRLF
     260/    F147 :                     
     261/    F147 :                     	;; Dump byte
     262/    F147 :                     DPB:
     263/    F147 : C4 20               	LD	A,=' '
     264/    F149 : 20 8D F7            	JSR	CONOUT
     265/    F14C : C3 14               	LD	A,W_DSTATE,P3
     266/    F14E : 7C 28               	BNZ	DPB2
     267/    F150 :                     	;; Dump state 0
     268/    F150 : 32                  	LD	EA,P2
     269/    F151 : BB 10               	SUB	EA,W_DSADDR,P3
     270/    F153 : 7C 03               	BNZ	DPB0
     271/    F155 : 40                  	LD	A,E
     272/    F156 : 6C 1C               	BZ	DPB1
     273/    F158 :                     	;; Still 0 or 2
     274/    F158 :                     DPB0:
     275/    F158 : C4 20               	LD	A,=' '
     276/    F15A : 20 8D F7            	JSR	CONOUT
     277/    F15D : C4 20               	LD	A,=' '
     278/    F15F : 20 8D F7            	JSR	CONOUT
     279/    F162 :                     
     280/    F162 : 56                  	PUSH	P2
     281/    F163 : 83 1A               	LD	EA,W_VAL,P3
     282/    F165 : 46                  	LD	P2,EA
     283/    F166 : C4 20               	LD	A,=' '
     284/    F168 : CE 01               	ST	A,@1,P2
     285/    F16A : 32                  	LD	EA,P2
     286/    F16B : 8B 1A               	ST	EA,W_VAL,P3
     287/    F16D : 5E                  	POP	P2
     288/    F16E :                     
     289/    F16E : 32                  	LD	EA,P2
     290/    F16F : B4 01 00            	ADD	EA,=1
     291/    F172 : 46                  	LD	P2,EA
     292/    F173 : 5C                  	RET
     293/    F174 :                     
     294/    F174 :                     	;; Found start address
     295/    F174 :                     DPB1:
     296/    F174 : C4 01               	LD	A,=1
     297/    F176 : CB 14               	ST	A,W_DSTATE,P3
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 7 - 01/27/23 00:33:42


     298/    F178 :                     DPB2:
     299/    F178 : C3 14               	LD	A,W_DSTATE,P3
     300/    F17A : FC 01               	SUB	A,=1
     301/    F17C : 7C DA               	BNZ	DPB0
     302/    F17E :                     	;; Dump state 1
     303/    F17E : C6 01               	LD	A,@1,P2
     304/    F180 : 56                  	PUSH	P2
     305/    F181 : 0A                  	PUSH	A
     306/    F182 : 83 1A               	LD	EA,W_VAL,P3
     307/    F184 : 46                  	LD	P2,EA
     308/    F185 : C1 00               	LD	A,0,SP
     309/    F187 : CE 01               	ST	A,@1,P2
     310/    F189 : 32                  	LD	EA,P2
     311/    F18A : 8B 1A               	ST	EA,W_VAL,P3
     312/    F18C : 38                  	POP	A
     313/    F18D : 5E                  	POP	P2
     314/    F18E : 20 27 F5            	JSR	HEXOUT2
     315/    F191 :                     
     316/    F191 : 32                  	LD	EA,P2
     317/    F192 : BB 12               	SUB	EA,W_DEADDR,P3
     318/    F194 : 7C 07               	BNZ	DPBE
     319/    F196 : 40                  	LD	A,E
     320/    F197 : 7C 04               	BNZ	DPBE
     321/    F199 :                     	;; Found end address
     322/    F199 : C4 02               	LD	A,=2
     323/    F19B : CB 14               	ST	A,W_DSTATE,P3
     324/    F19D :                     DPBE:
     325/    F19D : 5C                  	RET
     326/    F19E :                     
     327/    F19E :                     ;;; GO address
     328/    F19E :                     
     329/    F19E :                     GO:
     330/    F19E : C6 01               	LD	A,@1,P2		; INC P2
     331/    F1A0 : 20 E0 F5            	JSR	SKIPSP
     332/    F1A3 : 20 FB F5            	JSR	RDHEX
     333/    F1A6 : 20 E0 F5            	JSR	SKIPSP
     334/    F1A9 : C2 00               	LD	A,0,P2
     335/    F1AB : 6C 03               	BZ	GO0
     336/    F1AD : 24 78 F0            	JMP	ERR
     337/    F1B0 :                     GO0:
     338/    F1B0 : C3 1C               	LD	A,W_CNT,P3
     339/    F1B2 : 6C 04               	BZ	G0
     340/    F1B4 : 83 1A               	LD	EA,W_VAL,P3
     341/    F1B6 :                     
     342/    F1B6 : =>TRUE               	IF USE_REGCMD
     343/    F1B6 :                     
     344/    F1B6 : 8B 24               	ST	EA,W_REGPC,P3
     345/    F1B8 :                     G0:
     346/    F1B8 : 83 26               	LD	EA,W_REGSP,P3
     347/    F1BA : 45                  	LD	SP,EA
     348/    F1BB : 83 24               	LD	EA,W_REGPC,P3
     349/    F1BD : BC 01 00            	SUB	EA,=1
     350/    F1C0 : 08                  	PUSH	EA
     351/    F1C1 : 83 1F               	LD	EA,W_REGEA,P3
     352/    F1C3 : 08                  	PUSH	EA
     353/    F1C4 : 83 2A               	LD	EA,W_REGP3,P3
     354/    F1C6 : 08                  	PUSH	EA
     355/    F1C7 : 83 28               	LD	EA,W_REGP2,P3
     356/    F1C9 : 46                  	LD	P2,EA
     357/    F1CA : 83 21               	LD	EA,W_REGT,P3
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 8 - 01/27/23 00:33:42


     358/    F1CC : 09                  	LD	T,EA
     359/    F1CD : C3 23               	LD	A,W_REGS,P3
     360/    F1CF : 07                  	LD	S,A
     361/    F1D0 : 5F                  	POP	P3
     362/    F1D1 : 3A                  	POP	EA
     363/    F1D2 : 5C                  	RET
     364/    F1D3 :                     
     365/    F1D3 : =>FALSE              	ELSE			; USE_REGCMD
     366/    F1D3 :                     	
     367/    F1D3 :                     	ST	EA,W_GADDR,P3
     368/    F1D3 :                     G0:
     369/    F1D3 :                     	LD	EA,W_GADDR,P3
     370/    F1D3 :                     	SUB	EA,=1
     371/    F1D3 :                     	LD	PC,EA
     372/    F1D3 :                     
     373/    F1D3 : [342]                	ENDIF			; USE_REGCMD
     374/    F1D3 :                     
     375/    F1D3 :                     ;;; Set memory
     376/    F1D3 :                     
     377/    F1D3 :                     SETM:
     378/    F1D3 : C6 01               	LD	A,@1,P2		; INC P2
     379/    F1D5 : 20 E0 F5            	JSR	SKIPSP
     380/    F1D8 : 20 FB F5            	JSR	RDHEX
     381/    F1DB : 20 E0 F5            	JSR	SKIPSP
     382/    F1DE : C2 00               	LD	A,0,P2
     383/    F1E0 : 6C 03               	BZ	SM0
     384/    F1E2 : 24 78 F0            	JMP	ERR
     385/    F1E5 :                     SM0:
     386/    F1E5 : C3 1C               	LD	A,W_CNT,P3
     387/    F1E7 : 6C 04               	BZ	SM1
     388/    F1E9 : 83 1A               	LD	EA,W_VAL,P3
     389/    F1EB : 8B 17               	ST	EA,W_SADDR,P3
     390/    F1ED :                     SM1:
     391/    F1ED : C3 18               	LD	A,W_SADDR+1,P3
     392/    F1EF : 20 27 F5            	JSR	HEXOUT2
     393/    F1F2 : C3 17               	LD	A,W_SADDR,P3
     394/    F1F4 : 20 27 F5            	JSR	HEXOUT2
     395/    F1F7 :                     
     396/    F1F7 : 26 A7 F6            	LD	P2,=DSEP1
     397/    F1FA : 20 1D F5            	JSR	STROUT
     398/    F1FD :                     
     399/    F1FD : 83 17               	LD	EA,W_SADDR,P3
     400/    F1FF : 46                  	LD	P2,EA
     401/    F200 : C2 00               	LD	A,0,P2
     402/    F202 : 20 27 F5            	JSR	HEXOUT2
     403/    F205 : C4 20               	LD	A,=' '
     404/    F207 : 20 8D F7            	JSR	CONOUT
     405/    F20A :                     
     406/    F20A : 20 83 F5            	JSR	GETLIN
     407/    F20D : 26 C0 1F            	LD	P2,=WORK_INBUF
     408/    F210 : 20 E0 F5            	JSR	SKIPSP
     409/    F213 : C2 00               	LD	A,0,P2
     410/    F215 : 48                  	LD	E,A
     411/    F216 : 7C 09               	BNZ	SM2
     412/    F218 :                     	;; Empty (Increment address)
     413/    F218 : 83 17               	LD	EA,W_SADDR,P3
     414/    F21A : B4 01 00            	ADD	EA,=1
     415/    F21D : 8B 17               	ST	EA,W_SADDR,P3
     416/    F21F : 74 CC               	BRA	SM1
     417/    F221 :                     SM2:
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 9 - 01/27/23 00:33:42


     418/    F221 : 40                  	LD	A,E
     419/    F222 : FC 2D               	SUB	A,='-'
     420/    F224 : 7C 09               	BNZ	SM3
     421/    F226 :                     	;; '-' (Decrement address)
     422/    F226 : 83 17               	LD	EA,W_SADDR,P3
     423/    F228 : BC 01 00            	SUB	EA,=1
     424/    F22B : 8B 17               	ST	EA,W_SADDR,P3
     425/    F22D : 74 BE               	BRA	SM1
     426/    F22F :                     SM3:
     427/    F22F : 40                  	LD	A,E
     428/    F230 : FC 2E               	SUB	A,='.'
     429/    F232 : 7C 03               	BNZ	SM4
     430/    F234 :                     	;; '.' (Quit)
     431/    F234 : 24 2E F0            	JMP	WSTART
     432/    F237 :                     SM4:
     433/    F237 : 20 FB F5            	JSR	RDHEX
     434/    F23A : C3 1C               	LD	A,W_CNT,P3
     435/    F23C : 7C 03               	BNZ	SM5
     436/    F23E : 24 78 F0            	JMP	ERR
     437/    F241 :                     SM5:
     438/    F241 : 83 17               	LD	EA,W_SADDR,P3
     439/    F243 : 46                  	LD	P2,EA
     440/    F244 : B4 01 00            	ADD	EA,=1
     441/    F247 : 8B 17               	ST	EA,W_SADDR,P3
     442/    F249 : C3 1A               	LD	A,W_VAL,P3	; Low byte
     443/    F24B : CA 00               	ST	A,0,P2
     444/    F24D : 74 9E               	BRA	SM1
     445/    F24F :                     
     446/    F24F :                     ;;; LOAD HEX file
     447/    F24F :                     
     448/    F24F :                     LOADH:
     449/    F24F : C6 01               	LD	A,@1,P2
     450/    F251 : 20 E0 F5            	JSR	SKIPSP
     451/    F254 : 20 FB F5            	JSR	RDHEX
     452/    F257 : 20 E0 F5            	JSR	SKIPSP
     453/    F25A : C2 00               	LD	A,0,P2
     454/    F25C : 7C 20               	BNZ	LHE
     455/    F25E :                     
     456/    F25E : 20 7E F7            LH0:	JSR	CONIN
     457/    F261 : 20 E9 F5            	JSR	UPPER
     458/    F264 : 48                  	LD	E,A
     459/    F265 : FC 53               	SUB	A,='S'
     460/    F267 : 6C 70               	BZ	LHS0
     461/    F269 :                     LH1:
     462/    F269 : 40                  	LD	A,E
     463/    F26A : FC 3A               	SUB	A,=':'
     464/    F26C : 6C 13               	BZ	LHI0
     465/    F26E :                     LH2:
     466/    F26E :                     	;; Skip to EOL
     467/    F26E : 40                  	LD	A,E
     468/    F26F : FC 0D               	SUB	A,=CR
     469/    F271 : 6C EB               	BZ	LH0
     470/    F273 : 40                  	LD	A,E
     471/    F274 : FC 0A               	SUB	A,=LF
     472/    F276 : 6C E6               	BZ	LH0
     473/    F278 :                     LH3:
     474/    F278 : 20 7E F7            	JSR	CONIN
     475/    F27B : 48                  	LD	E,A
     476/    F27C : 74 F0               	BRA	LH2
     477/    F27E :                     LHE:
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 10 - 01/27/23 00:33:42


     478/    F27E : 24 78 F0            	JMP	ERR
     479/    F281 :                     
     480/    F281 :                     LHI0:
     481/    F281 : 20 45 F5            	JSR	HEXIN
     482/    F284 : CB 1D               	ST	A,W_SUM,P3
     483/    F286 : CB 1C               	ST	A,W_CNT,P3
     484/    F288 :                     
     485/    F288 : 20 45 F5            	JSR	HEXIN
     486/    F28B : 48                  	LD	E,A		; Address H
     487/    F28C : F3 1D               	ADD	A,W_SUM,P3
     488/    F28E : CB 1D               	ST	A,W_SUM,P3
     489/    F290 :                     
     490/    F290 : 20 45 F5            	JSR	HEXIN
     491/    F293 : 0A                  	PUSH	A
     492/    F294 : F3 1D               	ADD	A,W_SUM,P3
     493/    F296 : CB 1D               	ST	A,W_SUM,P3
     494/    F298 : 38                  	POP	A		; Address L
     495/    F299 :                     
     496/    F299 :                     	;; Add offset
     497/    F299 : B3 1A               	ADD	EA,W_VAL,P3
     498/    F29B : 46                  	LD	P2,EA
     499/    F29C :                     
     500/    F29C : 20 45 F5            	JSR	HEXIN
     501/    F29F : CB 1E               	ST	A,W_RECTYP,P3
     502/    F2A1 : F3 1D               	ADD	A,W_SUM,P3
     503/    F2A3 : CB 1D               	ST	A,W_SUM,P3
     504/    F2A5 : C3 1E               	LD	A,W_RECTYP,P3
     505/    F2A7 : FC 02               	SUB	A,=2
     506/    F2A9 : 64 CD               	BP	LH3		; Skip unsupported record type
     507/    F2AB :                     
     508/    F2AB : C3 1C               	LD	A,W_CNT,P3
     509/    F2AD : 6C 13               	BZ	LHI3
     510/    F2AF :                     LHI1:
     511/    F2AF : 20 45 F5            	JSR	HEXIN
     512/    F2B2 : 48                  	LD	E,A
     513/    F2B3 : F3 1D               	ADD	A,W_SUM,P3
     514/    F2B5 : CB 1D               	ST	A,W_SUM,P3
     515/    F2B7 :                     
     516/    F2B7 : C3 1E               	LD	A,W_RECTYP,P3
     517/    F2B9 : 7C 03               	BNZ	LHI2
     518/    F2BB :                     
     519/    F2BB : 40                  	LD	A,E
     520/    F2BC : CE 01               	ST	A,@1,P2
     521/    F2BE :                     LHI2:
     522/    F2BE : 9B 1C               	DLD	A,W_CNT,P3
     523/    F2C0 : 7C ED               	BNZ	LHI1
     524/    F2C2 :                     LHI3:
     525/    F2C2 : 20 45 F5            	JSR	HEXIN
     526/    F2C5 : F3 1D               	ADD	A,W_SUM,P3
     527/    F2C7 : 7C 07               	BNZ	LHIE		; Checksum error
     528/    F2C9 : C3 1E               	LD	A,W_RECTYP,P3
     529/    F2CB : 6C AB               	BZ	LH3
     530/    F2CD : 24 2E F0            	JMP	WSTART
     531/    F2D0 :                     LHIE:
     532/    F2D0 : 26 82 F6            	LD	P2,=IHEMSG
     533/    F2D3 : 20 1D F5            	JSR	STROUT
     534/    F2D6 : 24 2E F0            	JMP	WSTART
     535/    F2D9 :                     
     536/    F2D9 :                     LHS0:
     537/    F2D9 : C4 00               	LD	A,=0
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 11 - 01/27/23 00:33:42


     538/    F2DB : CB 1E               	ST	A,W_RECTYP,P3
     539/    F2DD : 20 7E F7            	JSR	CONIN
     540/    F2E0 : 48                  	LD	E,A
     541/    F2E1 : FC 31               	SUB	A,='1'
     542/    F2E3 : 6C 0B               	BZ	LHS02
     543/    F2E5 : 40                  	LD	A,E
     544/    F2E6 : FC 39               	SUB	A,='9'
     545/    F2E8 : 6C 02               	BZ	LHS01
     546/    F2EA : 74 8C               	BRA	LH3		; Unsupported record type
     547/    F2EC :                     LHS01:
     548/    F2EC : C4 01               	LD	A,=1
     549/    F2EE : CB 1E               	ST	A,W_RECTYP,P3
     550/    F2F0 :                     LHS02:
     551/    F2F0 :                     
     552/    F2F0 : 20 45 F5            	JSR	HEXIN
     553/    F2F3 : CB 1D               	ST	A,W_SUM,P3
     554/    F2F5 : FC 03               	SUB	A,=3
     555/    F2F7 : CB 1C               	ST	A,W_CNT,P3
     556/    F2F9 :                     
     557/    F2F9 : 20 45 F5            	JSR	HEXIN
     558/    F2FC : 48                  	LD	E,A		; Address H
     559/    F2FD : F3 1D               	ADD	A,W_SUM,P3
     560/    F2FF : CB 1D               	ST	A,W_SUM,P3
     561/    F301 :                     
     562/    F301 : 20 45 F5            	JSR	HEXIN
     563/    F304 : 0A                  	PUSH	A
     564/    F305 : F3 1D               	ADD	A,W_SUM,P3
     565/    F307 : CB 1D               	ST	A,W_SUM,P3
     566/    F309 : 38                  	POP	A		; Address L
     567/    F30A :                     
     568/    F30A :                     	;; Add offset
     569/    F30A : B3 1A               	ADD	EA,W_VAL,P3
     570/    F30C : 46                  	LD	P2,EA
     571/    F30D :                     
     572/    F30D : C3 1C               	LD	A,W_CNT,P3
     573/    F30F : 6C 13               	BZ	LHS3
     574/    F311 :                     LHS1:
     575/    F311 : 20 45 F5            	JSR	HEXIN
     576/    F314 : 48                  	LD	E,A
     577/    F315 : F3 1D               	ADD	A,W_SUM,P3
     578/    F317 : CB 1D               	ST	A,W_SUM,P3
     579/    F319 :                     
     580/    F319 : C3 1E               	LD	A,W_RECTYP,P3
     581/    F31B : 7C 03               	BNZ	LHS2
     582/    F31D :                     
     583/    F31D : 40                  	LD	A,E
     584/    F31E : CE 01               	ST	A,@1,P2
     585/    F320 :                     LHS2:
     586/    F320 : 9B 1C               	DLD	A,W_CNT,P3
     587/    F322 : 7C ED               	BNZ	LHS1
     588/    F324 :                     LHS3:
     589/    F324 :                     
     590/    F324 : 20 45 F5            	JSR	HEXIN
     591/    F327 : F3 1D               	ADD	A,W_SUM,P3
     592/    F329 : FC FF               	SUB	A,=0xFF
     593/    F32B : 7C 07               	BNZ	LHSE		; Checksum error
     594/    F32D :                     
     595/    F32D : C3 1E               	LD	A,W_RECTYP,P3
     596/    F32F : 7C 09               	BNZ	LHSR
     597/    F331 : 24 77 F2            	JMP	LH3
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 12 - 01/27/23 00:33:42


     598/    F334 :                     LHSE:
     599/    F334 : 26 8F F6            	LD	P2,=SHEMSG
     600/    F337 : 20 1D F5            	JSR	STROUT
     601/    F33A :                     LHSR:
     602/    F33A : 24 2E F0            	JMP	WSTART
     603/    F33D :                     
     604/    F33D :                     ;;; SAVE HEX file
     605/    F33D :                     
     606/    F33D :                     SAVEH:
     607/    F33D : C6 01               	LD	A,@1,P2
     608/    F33F : C2 00               	LD	A,0,P2
     609/    F341 : 20 E9 F5            	JSR	UPPER
     610/    F344 : 48                  	LD	E,A
     611/    F345 : FC 49               	SUB	A,='I'
     612/    F347 : 6C 05               	BZ	SH0
     613/    F349 : 40                  	LD	A,E
     614/    F34A : FC 53               	SUB	A,='S'
     615/    F34C : 7C 05               	BNZ	SH1
     616/    F34E :                     SH0:
     617/    F34E : C6 01               	LD	A,@1,P2
     618/    F350 : 40                  	LD	A,E
     619/    F351 : CB 19               	ST	A,W_HEXMOD,P3
     620/    F353 :                     SH1:
     621/    F353 : 20 E0 F5            	JSR	SKIPSP
     622/    F356 : 20 FB F5            	JSR	RDHEX
     623/    F359 : C3 1C               	LD	A,W_CNT,P3
     624/    F35B : 6C 20               	BZ	SHE		; Start address missing
     625/    F35D : 83 1A               	LD	EA,W_VAL,P3
     626/    F35F : 08                  	PUSH	EA		; Start address
     627/    F360 : 20 E0 F5            	JSR	SKIPSP
     628/    F363 : C6 01               	LD	A,@1,P2
     629/    F365 : FC 2C               	SUB	A,=','
     630/    F367 : 7C 13               	BNZ	SHEP
     631/    F369 : 20 E0 F5            	JSR	SKIPSP
     632/    F36C : 20 FB F5            	JSR	RDHEX
     633/    F36F : C3 1C               	LD	A,W_CNT,P3
     634/    F371 : 6C 09               	BZ	SHEP		; End address missing
     635/    F373 : A3 1A               	LD	T,W_VAL,P3	; T = End address
     636/    F375 : 20 E0 F5            	JSR	SKIPSP
     637/    F378 : C2 00               	LD	A,0,P2
     638/    F37A : 6C 04               	BZ	SH2
     639/    F37C :                     SHEP:
     640/    F37C : 3A                  	POP	EA		; Drop start address on stack
     641/    F37D :                     SHE:
     642/    F37D : 24 78 F0            	JMP	ERR
     643/    F380 :                     
     644/    F380 :                     SH2:
     645/    F380 : 3A                  	POP	EA		; Start address
     646/    F381 : 46                  	LD	P2,EA
     647/    F382 : 8B 1A               	ST	EA,W_VAL,P3
     648/    F384 : 0B                  	LD	EA,T
     649/    F385 : BB 1A               	SUB	EA,W_VAL,P3	; <end> - <start>
     650/    F387 : B4 01 00            	ADD	EA,=1
     651/    F38A : 09                  	LD	T,EA		; T = Length
     652/    F38B :                     SH3:	
     653/    F38B : 20 A9 F3            	JSR	SHL
     654/    F38E : 0B                  	LD	EA,T
     655/    F38F : 58                  	OR	A,E
     656/    F390 : 7C F9               	BNZ	SH3
     657/    F392 :                     
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 13 - 01/27/23 00:33:42


     658/    F392 : C3 19               	LD	A,W_HEXMOD,P3
     659/    F394 : FC 49               	SUB	A,='I'
     660/    F396 : 7C 09               	BNZ	SH4
     661/    F398 :                     	;; End record for Intel HEX
     662/    F398 : 26 AB F6            	LD	P2,=IHEXER
     663/    F39B : 20 1D F5            	JSR	STROUT
     664/    F39E : 24 2E F0            	JMP	WSTART
     665/    F3A1 :                     SH4:
     666/    F3A1 :                     	;; End record for Motorola S record
     667/    F3A1 : 26 B9 F6            	LD	P2,=SRECER
     668/    F3A4 : 20 1D F5            	JSR	STROUT
     669/    F3A7 : 24 2E F0            	JMP	WSTART
     670/    F3AA :                     
     671/    F3AA :                     SHL:
     672/    F3AA : C4 10               	LD	A,=16
     673/    F3AC : CB 1C               	ST	A,W_CNT,P3
     674/    F3AE : 0B                  	LD	EA,T
     675/    F3AF : D4 F0               	AND	A,=0xF0
     676/    F3B1 : 7C 0C               	BNZ	SHL0		; T >= 16
     677/    F3B3 : 40                  	LD	A,E
     678/    F3B4 : 7C 09               	BNZ	SHL0		; T >= 16
     679/    F3B6 : 0B                  	LD	EA,T
     680/    F3B7 : CB 1C               	ST	A,W_CNT,P3
     681/    F3B9 : 84 00 00            	LD	EA,=0
     682/    F3BC : 09                  	LD	T,EA
     683/    F3BD : 74 09               	BRA	SHL1
     684/    F3BF :                     SHL0:
     685/    F3BF : 84 10 00            	LD	EA,=16
     686/    F3C2 : 8B 1A               	ST	EA,W_VAL,P3
     687/    F3C4 : 0B                  	LD	EA,T
     688/    F3C5 : BB 1A               	SUB	EA,W_VAL,P3
     689/    F3C7 : 09                  	LD	T,EA		; T = T - 16
     690/    F3C8 :                     SHL1:
     691/    F3C8 : C3 19               	LD	A,W_HEXMOD,P3
     692/    F3CA : FC 49               	SUB	A,='I'
     693/    F3CC : 7C 3E               	BNZ	SHLS
     694/    F3CE :                     
     695/    F3CE :                     	;; Intel HEX
     696/    F3CE : C4 3A               	LD	A,=':'
     697/    F3D0 : 20 8D F7            	JSR	CONOUT
     698/    F3D3 :                     
     699/    F3D3 : C3 1C               	LD	A,W_CNT,P3
     700/    F3D5 : CB 1D               	ST	A,W_SUM,P3	; Checksum
     701/    F3D7 : 20 27 F5            	JSR	HEXOUT2		; Length
     702/    F3DA :                     
     703/    F3DA : 32                  	LD	EA,P2
     704/    F3DB : 40                  	LD	A,E
     705/    F3DC : F3 1D               	ADD	A,W_SUM,P3
     706/    F3DE : CB 1D               	ST	A,W_SUM,P3	; Checksum
     707/    F3E0 : 40                  	LD	A,E
     708/    F3E1 : 20 27 F5            	JSR	HEXOUT2		; Address H
     709/    F3E4 :                     
     710/    F3E4 : 32                  	LD	EA,P2
     711/    F3E5 : 48                  	LD	E,A
     712/    F3E6 : F3 1D               	ADD	A,W_SUM,P3
     713/    F3E8 : CB 1D               	ST	A,W_SUM,P3
     714/    F3EA : 40                  	LD	A,E
     715/    F3EB : 20 27 F5            	JSR	HEXOUT2		; Address L
     716/    F3EE :                     
     717/    F3EE : C4 00               	LD	A,=0
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 14 - 01/27/23 00:33:42


     718/    F3F0 : 20 27 F5            	JSR	HEXOUT2		; Record type
     719/    F3F3 :                     SHLI0:
     720/    F3F3 : C6 01               	LD	A,@1,P2
     721/    F3F5 : 48                  	LD	E,A
     722/    F3F6 : F3 1D               	ADD	A,W_SUM,P3
     723/    F3F8 : CB 1D               	ST	A,W_SUM,P3
     724/    F3FA : 40                  	LD	A,E
     725/    F3FB : 20 27 F5            	JSR	HEXOUT2
     726/    F3FE :                     
     727/    F3FE : 9B 1C               	DLD	A,W_CNT,P3
     728/    F400 : 7C F1               	BNZ	SHLI0
     729/    F402 :                     
     730/    F402 : C4 00               	LD	A,=0
     731/    F404 : FB 1D               	SUB	A,W_SUM,P3
     732/    F406 : 20 27 F5            	JSR	HEXOUT2
     733/    F409 : 24 79 F5            	JMP	CRLF
     734/    F40C :                     
     735/    F40C :                     SHLS:
     736/    F40C :                     	;; Motorola S record
     737/    F40C : C4 53               	LD	A,='S'
     738/    F40E : 20 8D F7            	JSR	CONOUT
     739/    F411 : C4 31               	LD	A,='1'
     740/    F413 : 20 8D F7            	JSR	CONOUT
     741/    F416 :                     
     742/    F416 : C3 1C               	LD	A,W_CNT,P3
     743/    F418 : F4 03               	ADD	A,=3		; DataLength + 2 (addr) + 1 (sum)
     744/    F41A : CB 1D               	ST	A,W_SUM,P3
     745/    F41C : 20 27 F5            	JSR	HEXOUT2
     746/    F41F :                     
     747/    F41F : 32                  	LD	EA,P2
     748/    F420 : 40                  	LD	A,E
     749/    F421 : F3 1D               	ADD	A,W_SUM,P3
     750/    F423 : CB 1D               	ST	A,W_SUM,P3
     751/    F425 : 40                  	LD	A,E
     752/    F426 : 20 27 F5            	JSR	HEXOUT2		; Address H
     753/    F429 :                     
     754/    F429 : 32                  	LD	EA,P2
     755/    F42A : 48                  	LD	E,A
     756/    F42B : F3 1D               	ADD	A,W_SUM,P3
     757/    F42D : CB 1D               	ST	A,W_SUM,P3
     758/    F42F : 40                  	LD	A,E
     759/    F430 : 20 27 F5            	JSR	HEXOUT2		; Address L
     760/    F433 :                     
     761/    F433 :                     SHLS0:
     762/    F433 : C6 01               	LD	A,@1,P2
     763/    F435 : 48                  	LD	E,A
     764/    F436 : F3 1D               	ADD	A,W_SUM,P3
     765/    F438 : CB 1D               	ST	A,W_SUM,P3
     766/    F43A : 40                  	LD	A,E
     767/    F43B : 20 27 F5            	JSR	HEXOUT2
     768/    F43E :                     
     769/    F43E : 9B 1C               	DLD	A,W_CNT,P3
     770/    F440 : 7C F1               	BNZ	SHLS0
     771/    F442 :                     
     772/    F442 : C3 1D               	LD	A,W_SUM,P3
     773/    F444 : E4 FF               	XOR	A,=0xFF
     774/    F446 : 20 27 F5            	JSR	HEXOUT2
     775/    F449 : 24 79 F5            	JMP	CRLF
     776/    F44C :                     
     777/    F44C :                     ;;; Register
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 15 - 01/27/23 00:33:42


     778/    F44C :                     
     779/    F44C : =>TRUE               	IF USE_REGCMD
     780/    F44C :                     
     781/    F44C :                     REG:
     782/    F44C : C6 01               	LD	A,@1,P2
     783/    F44E : 20 E0 F5            	JSR	SKIPSP
     784/    F451 : 20 E9 F5            	JSR	UPPER
     785/    F454 : 7C 06               	BNZ	RG0
     786/    F456 : 20 E6 F4            	JSR	RDUMP
     787/    F459 : 24 2E F0            	JMP	WSTART
     788/    F45C :                     RG0:
     789/    F45C : 27 17 F7            	LD	P3,=RNTAB
     790/    F45F :                     RG1:
     791/    F45F : 48                  	LD	E,A
     792/    F460 : E7 01               	XOR	A,@1,P3
     793/    F462 : 6C 09               	BZ	RG2		; Character match
     794/    F464 : C3 00               	LD	A,0,P3
     795/    F466 : 6C 79               	BZ	RGE		; Found end mark
     796/    F468 : C7 05               	LD	A,@5,P3
     797/    F46A : 40                  	LD	A,E
     798/    F46B : 74 F2               	BRA	RG1
     799/    F46D :                     RG2:
     800/    F46D : C7 01               	LD	A,@1,P3
     801/    F46F : 48                  	LD	E,A
     802/    F470 : FC 0F               	SUB	A,=0x0F		; Link code
     803/    F472 : 7C 0C               	BNZ	RG3
     804/    F474 :                     	;; Next table
     805/    F474 : 83 00               	LD	EA,0,P3
     806/    F476 : 47                  	LD	P3,EA
     807/    F477 : C6 01               	LD	A,@1,P2
     808/    F479 : C2 00               	LD	A,0,P2
     809/    F47B : 20 E9 F5            	JSR	UPPER
     810/    F47E : 74 DF               	BRA	RG1
     811/    F480 :                     RG3:
     812/    F480 : 40                  	LD	A,E
     813/    F481 : 6C 5E               	BZ	RGE		; Found end mark
     814/    F483 : D4 07               	AND	A,=0x07
     815/    F485 : 0A                  	PUSH	A
     816/    F486 : 87 02               	LD	EA,@2,P3
     817/    F488 : 08                  	PUSH	EA		; Reg storage address
     818/    F489 : 83 00               	LD	EA,0,P3
     819/    F48B : 46                  	LD	P2,EA		; Reg name
     820/    F48C : 20 1D F5            	JSR	STROUT
     821/    F48F : C4 3D               	LD	A,='='
     822/    F491 : 20 8D F7            	JSR	CONOUT
     823/    F494 : C1 02               	LD	A,2,SP
     824/    F496 : FC 01               	SUB	A,=1
     825/    F498 : 7C 09               	BNZ	RG4
     826/    F49A :                     	;; 8 bit register
     827/    F49A : 5E                  	POP	P2
     828/    F49B : C2 00               	LD	A,0,P2
     829/    F49D : 56                  	PUSH	P2
     830/    F49E : 20 27 F5            	JSR	HEXOUT2
     831/    F4A1 : 74 0D               	BRA	RG5
     832/    F4A3 :                     RG4:
     833/    F4A3 :                     	;; 16 bit register
     834/    F4A3 : 5E                  	POP	P2
     835/    F4A4 : 82 00               	LD	EA,0,P2
     836/    F4A6 : 56                  	PUSH	P2
     837/    F4A7 : 08                  	PUSH	EA
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 16 - 01/27/23 00:33:42


     838/    F4A8 : 40                  	LD	A,E
     839/    F4A9 : 20 27 F5            	JSR	HEXOUT2
     840/    F4AC : 3A                  	POP	EA
     841/    F4AD : 20 27 F5            	JSR	HEXOUT2
     842/    F4B0 :                     RG5:
     843/    F4B0 : C4 20               	LD	A,=' '
     844/    F4B2 : 20 8D F7            	JSR	CONOUT
     845/    F4B5 : 27 C0 1F            	LD	P3,=WORK
     846/    F4B8 : 20 83 F5            	JSR	GETLIN
     847/    F4BB : 26 C0 1F            	LD	P2,=WORK_INBUF
     848/    F4BE : 20 E0 F5            	JSR	SKIPSP
     849/    F4C1 : 20 FB F5            	JSR	RDHEX
     850/    F4C4 : C3 1C               	LD 	A,W_CNT,P3
     851/    F4C6 : 6C 16               	BZ	RGR
     852/    F4C8 : C1 02               	LD	A,2,SP
     853/    F4CA : FC 01               	SUB	A,=1
     854/    F4CC : 7C 07               	BNZ	RG6
     855/    F4CE :                     	;; 8 bit register
     856/    F4CE : 5E                  	POP	P2
     857/    F4CF : C3 1A               	LD	A,W_VAL,P3
     858/    F4D1 : CA 00               	ST	A,0,P2
     859/    F4D3 : 74 05               	BRA	RG7
     860/    F4D5 :                     RG6:
     861/    F4D5 :                     	;; 16 bit register
     862/    F4D5 : 5E                  	POP	P2
     863/    F4D6 : 83 1A               	LD	EA,W_VAL,P3
     864/    F4D8 : 8A 00               	ST	EA,0,P2
     865/    F4DA :                     RG7:
     866/    F4DA : 38                  	POP	A
     867/    F4DB : 24 2E F0            	JMP	WSTART
     868/    F4DE :                     RGR:
     869/    F4DE : 5E                  	POP	P2
     870/    F4DF : 74 F9               	BRA	RG7
     871/    F4E1 :                     RGE:
     872/    F4E1 : 27 C0 1F            	LD	P3,=WORK
     873/    F4E4 : 24 78 F0            	JMP	ERR
     874/    F4E7 :                     	
     875/    F4E7 :                     RDUMP:
     876/    F4E7 : 26 CE F6            	LD	P2,=RDTAB
     877/    F4EA :                     RD0:
     878/    F4EA : 86 02               	LD	EA,@2,P2
     879/    F4EC : 09                  	LD	T,EA
     880/    F4ED : 58                  	OR	A,E
     881/    F4EE : 6C 2B               	BZ	RDR
     882/    F4F0 : 56                  	PUSH	P2
     883/    F4F1 : 0B                  	LD	EA,T
     884/    F4F2 : 46                  	LD	P2,EA
     885/    F4F3 : 20 1D F5            	JSR	STROUT
     886/    F4F6 : 5E                  	POP	P2
     887/    F4F7 : A6 02               	LD	T,@2,P2
     888/    F4F9 : C6 01               	LD	A,@1,P2
     889/    F4FB : FC 01               	SUB	A,=1
     890/    F4FD : 7C 0B               	BNZ	RD1
     891/    F4FF :                     	;; 1 byte
     892/    F4FF : 0B                  	LD	EA,T
     893/    F500 : 56                  	PUSH	P2
     894/    F501 : 46                  	LD	P2,EA
     895/    F502 : C2 00               	LD	A,0,P2
     896/    F504 : 5E                  	POP	P2
     897/    F505 : 20 27 F5            	JSR	HEXOUT2
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 17 - 01/27/23 00:33:42


     898/    F508 : 74 E0               	BRA	RD0
     899/    F50A :                     RD1:
     900/    F50A :                     	;; 2 byte
     901/    F50A : 0B                  	LD	EA,T
     902/    F50B : 56                  	PUSH	P2
     903/    F50C : 46                  	LD	P2,EA
     904/    F50D : A2 00               	LD	T,0,P2
     905/    F50F : 5E                  	POP	P2
     906/    F510 : 0B                  	LD	EA,T
     907/    F511 : 40                  	LD	A,E
     908/    F512 : 20 27 F5            	JSR	HEXOUT2
     909/    F515 : 0B                  	LD	EA,T
     910/    F516 : 20 27 F5            	JSR	HEXOUT2
     911/    F519 : 74 CF               	BRA	RD0
     912/    F51B :                     RDR:
     913/    F51B : 24 79 F5            	JMP	CRLF
     914/    F51E :                     
     915/    F51E : [779]                	ENDIF			; USE_REGCMD
     916/    F51E :                     
     917/    F51E :                     ;;; Other support routines
     918/    F51E :                     
     919/    F51E :                     STROUT:
     920/    F51E : C6 01               	LD	A,@+1,P2
     921/    F520 : 6C 05               	BZ	STROR
     922/    F522 : 20 8D F7            	JSR	CONOUT
     923/    F525 : 74 F7               	BRA	STROUT
     924/    F527 :                     STROR:
     925/    F527 : 5C                  	RET
     926/    F528 :                     
     927/    F528 :                     HEXOUT2:
     928/    F528 : 0A                  	PUSH	A
     929/    F529 : 3C                  	SR	A
     930/    F52A : 3C                  	SR	A
     931/    F52B : 3C                  	SR	A
     932/    F52C : 3C                  	SR	A
     933/    F52D : 20 30 F5            	JSR	HEXOUT1
     934/    F530 : 38                  	POP	A
     935/    F531 :                     HEXOUT1:
     936/    F531 : 08                  	PUSH	EA
     937/    F532 : D4 0F               	AND	A,=0x0F
     938/    F534 : F4 30               	ADD	A,='0'
     939/    F536 : 48                  	LD	E,A
     940/    F537 : FC 3A               	SUB	A,='9'+1
     941/    F539 : 64 06               	BP	HEXOUT0
     942/    F53B : 40                  	LD	A,E
     943/    F53C :                     HEXOUTE:
     944/    F53C : 20 8D F7            	JSR	CONOUT
     945/    F53F : 3A                  	POP	EA
     946/    F540 : 5C                  	RET
     947/    F541 :                     HEXOUT0:
     948/    F541 : 40                  	LD	A,E
     949/    F542 : F4 07               	ADD	A,='A'-'9'-1
     950/    F544 : 74 F6               	BRA	HEXOUTE
     951/    F546 :                     
     952/    F546 :                     HEXIN:
     953/    F546 : C4 00               	LD	A,=0
     954/    F548 : 20 4E F5            	JSR	HI0
     955/    F54B : 0E                  	SL	A
     956/    F54C : 0E                  	SL	A
     957/    F54D : 0E                  	SL	A
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 18 - 01/27/23 00:33:42


     958/    F54E : 0E                  	SL	A
     959/    F54F :                     HI0:
     960/    F54F : 08                  	PUSH	EA
     961/    F550 : 20 7E F7            	JSR	CONIN
     962/    F553 : 20 E9 F5            	JSR	UPPER
     963/    F556 : 48                  	LD	E,A
     964/    F557 : FC 47               	SUB	A,='F'+1
     965/    F559 : 64 0F               	BP	HIR
     966/    F55B : 40                  	LD	A,E
     967/    F55C : FC 41               	SUB	A,='A'
     968/    F55E : 64 11               	BP	HI2
     969/    F560 : 40                  	LD	A,E
     970/    F561 : FC 3A               	SUB	A,='9'+1
     971/    F563 : 64 05               	BP	HIR
     972/    F565 : 40                  	LD	A,E
     973/    F566 : FC 30               	SUB	A,='0'
     974/    F568 : 64 02               	BP	HI1
     975/    F56A :                     HIR:
     976/    F56A : 3A                  	POP	EA
     977/    F56B : 5C                  	RET
     978/    F56C :                     HI1:
     979/    F56C : 40                  	LD	A,E
     980/    F56D : FC 30               	SUB	A,='0'
     981/    F56F : 74 03               	BRA	HI3
     982/    F571 :                     HI2:
     983/    F571 : 40                  	LD	A,E
     984/    F572 : FC 37               	SUB	A,='A'-10
     985/    F574 :                     HI3:
     986/    F574 : D9 00               	OR	A,0,SP
     987/    F576 : C9 00               	ST	A,0,SP
     988/    F578 : 74 F0               	BRA	HIR
     989/    F57A :                     	
     990/    F57A :                     CRLF:
     991/    F57A : C4 0D               	LD	A,=CR
     992/    F57C : 20 8D F7            	JSR	CONOUT
     993/    F57F : C4 0A               	LD	A,=LF
     994/    F581 : 24 8D F7            	JMP	CONOUT
     995/    F584 :                     
     996/    F584 :                     GETLIN:
     997/    F584 : 26 C0 1F            	LD	P2,=WORK_INBUF
     998/    F587 : C4 00               	LD	A,=0
     999/    F589 : CB 1C               	ST	A,W_CNT,P3
    1000/    F58B :                     GL0:
    1001/    F58B : 20 7E F7            	JSR	CONIN
    1002/    F58E : 48                  	LD	E,A
    1003/    F58F : FC 0D               	SUB	A,=CR
    1004/    F591 : 6C 05               	BZ	GLE
    1005/    F593 : 40                  	LD	A,E
    1006/    F594 : FC 0A               	SUB	A,=LF
    1007/    F596 : 7C 08               	BNZ	GL1
    1008/    F598 :                     GLE:
    1009/    F598 : 20 79 F5            	JSR	CRLF
    1010/    F59B : C4 00               	LD	A,=0
    1011/    F59D : CA 00               	ST	A,0,P2
    1012/    F59F : 5C                  	RET
    1013/    F5A0 :                     GL1:	
    1014/    F5A0 : 40                  	LD	A,E
    1015/    F5A1 : FC 08               	SUB	A,=BS
    1016/    F5A3 : 6C 05               	BZ	GLB
    1017/    F5A5 : 40                  	LD	A,E
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 19 - 01/27/23 00:33:42


    1018/    F5A6 : FC 7F               	SUB	A,=DEL
    1019/    F5A8 : 7C 1B               	BNZ	GL2
    1020/    F5AA :                     GLB:
    1021/    F5AA : C3 1C               	LD	A,W_CNT,P3
    1022/    F5AC : 6C DD               	BZ	GL0
    1023/    F5AE : FC 01               	SUB	A,=1
    1024/    F5B0 : CB 1C               	ST	A,W_CNT,P3
    1025/    F5B2 : C6 FF               	LD	A,@-1,P2	; DEC P2
    1026/    F5B4 : C4 08               	LD	A,=BS
    1027/    F5B6 : 20 8D F7            	JSR	CONOUT
    1028/    F5B9 : C4 20               	LD	A,=' '
    1029/    F5BB : 20 8D F7            	JSR	CONOUT
    1030/    F5BE : C4 08               	LD	A,=BS
    1031/    F5C0 : 20 8D F7            	JSR	CONOUT
    1032/    F5C3 : 74 C6               	BRA	GL0
    1033/    F5C5 :                     GL2:
    1034/    F5C5 : 40                  	LD	A,E
    1035/    F5C6 : FC 20               	SUB	A,=' '
    1036/    F5C8 : 64 02               	BP	GL3
    1037/    F5CA : 74 BF               	BRA	GL0		; 0x00-0x1F
    1038/    F5CC :                     GL3:
    1039/    F5CC : 40                  	LD	A,E
    1040/    F5CD : FC 7F               	SUB	A,=0x7F
    1041/    F5CF : 64 BA               	BP	GL0		; 0x7F-0xFF
    1042/    F5D1 : C3 1C               	LD	A,W_CNT,P3
    1043/    F5D3 : FC 0F               	SUB	A,=BUFLEN-1
    1044/    F5D5 : 64 B4               	BP	GL0
    1045/    F5D7 : 93 1C               	ILD	A,W_CNT,P3	; INC CNT
    1046/    F5D9 : 40                  	LD	A,E
    1047/    F5DA : CE 01               	ST	A,@1,P2
    1048/    F5DC : 20 8D F7            	JSR	CONOUT
    1049/    F5DF : 74 AA               	BRA	GL0
    1050/    F5E1 :                     
    1051/    F5E1 :                     SKIPSP:
    1052/    F5E1 : C6 01               	LD	A,@1,P2
    1053/    F5E3 : FC 20               	SUB	A,=' '
    1054/    F5E5 : 6C FA               	BZ	SKIPSP
    1055/    F5E7 : C6 FF               	LD	A,@-1,P2
    1056/    F5E9 : 5C                  	RET
    1057/    F5EA :                     
    1058/    F5EA :                     UPPER:
    1059/    F5EA : 48                  	LD	E,A
    1060/    F5EB : FC 61               	SUB	A,='a'
    1061/    F5ED : 64 02               	BP	UP0
    1062/    F5EF : 74 09               	BRA	UPR
    1063/    F5F1 :                     UP0:
    1064/    F5F1 : 40                  	LD	A,E
    1065/    F5F2 : FC 7B               	SUB	A,='z'+1
    1066/    F5F4 : 64 04               	BP	UPR
    1067/    F5F6 : 40                  	LD	A,E
    1068/    F5F7 : F4 E0               	ADD	A,='A'-'a'
    1069/    F5F9 : 5C                  	RET
    1070/    F5FA :                     UPR:
    1071/    F5FA : 40                  	LD	A,E
    1072/    F5FB : 5C                  	RET
    1073/    F5FC :                     
    1074/    F5FC :                     RDHEX:
    1075/    F5FC : 84 00 00            	LD	EA,=0
    1076/    F5FF : CB 1C               	ST	A,W_CNT,P3
    1077/    F601 : 8B 1A               	ST	EA,W_VAL,P3
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 20 - 01/27/23 00:33:42


    1078/    F603 :                     RH0:
    1079/    F603 : C6 01               	LD	A,@1,P2
    1080/    F605 : 20 E9 F5            	JSR	UPPER
    1081/    F608 : 48                  	LD	E,A
    1082/    F609 : FC 30               	SUB	A,='0'
    1083/    F60B : 64 02               	BP	RH01
    1084/    F60D : 74 29               	BRA	RHE
    1085/    F60F :                     RH01:
    1086/    F60F : 40                  	LD	A,E
    1087/    F610 : FC 3A               	SUB	A,='9'+1
    1088/    F612 : 64 03               	BP	RH02
    1089/    F614 : 40                  	LD	A,E
    1090/    F615 : 74 0F               	BRA	RH1
    1091/    F617 :                     RH02:
    1092/    F617 : 40                  	LD	A,E
    1093/    F618 : FC 41               	SUB	A,='A'
    1094/    F61A : 64 02               	BP	RH03
    1095/    F61C : 74 1A               	BRA	RHE
    1096/    F61E :                     RH03:
    1097/    F61E : 40                  	LD	A,E
    1098/    F61F : FC 47               	SUB	A,='F'+1
    1099/    F621 : 64 15               	BP	RHE
    1100/    F623 : 40                  	LD	A,E
    1101/    F624 : FC 07               	SUB	A,='A'-'9'-1
    1102/    F626 :                     RH1:
    1103/    F626 : FC 30               	SUB	A,='0'
    1104/    F628 : 0A                  	PUSH	A
    1105/    F629 : 83 1A               	LD	EA,W_VAL,P3
    1106/    F62B : 0F                  	SL	EA
    1107/    F62C : 0F                  	SL	EA
    1108/    F62D : 0F                  	SL	EA
    1109/    F62E : 0F                  	SL	EA
    1110/    F62F : D9 00               	OR	A,0,SP
    1111/    F631 : 8B 1A               	ST	EA,W_VAL,P3
    1112/    F633 : 38                  	POP	A		; Drop
    1113/    F634 : 93 1C               	ILD	A,W_CNT,P3
    1114/    F636 : 74 CB               	BRA	RH0
    1115/    F638 :                     RHE:
    1116/    F638 : C6 FF               	LD	A,@-1,P2	; DEC P2
    1117/    F63A : 5C                  	RET
    1118/    F63B :                     
    1119/    F63B :                     DUMMY:
    1120/    F63B : 5C                  	RET
    1121/    F63C :                     
    1122/    F63C :                     ;;;  BREAK
    1123/    F63C :                     
    1124/    F63C :                     BREAK:
    1125/    F63C : =>TRUE               	IF USE_REGCMD
    1126/    F63C :                     
    1127/    F63C : 08                  	PUSH	EA
    1128/    F63D : 23 C0 1F            	PLI	P3,=WORK
    1129/    F640 : 06                  	LD	A,S
    1130/    F641 : CB 23               	ST	A,W_REGS,P3
    1131/    F643 : 0B                  	LD	EA,T
    1132/    F644 : 8B 21               	ST	EA,W_REGT,P3
    1133/    F646 : 32                  	LD	EA,P2
    1134/    F647 : 8B 28               	ST	EA,W_REGP2,P3
    1135/    F649 : 3A                  	POP	EA
    1136/    F64A : 8B 2A               	ST	EA,W_REGP3,P3
    1137/    F64C : 3A                  	POP	EA
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 21 - 01/27/23 00:33:42


    1138/    F64D : 8B 1F               	ST	EA,W_REGEA,P3
    1139/    F64F : 3A                  	POP	EA
    1140/    F650 : 8B 24               	ST	EA,W_REGPC,P3
    1141/    F652 : 31                  	LD	EA,SP
    1142/    F653 : 8B 26               	ST	EA,W_REGSP,P3
    1143/    F655 :                     
    1144/    F655 : 26 C6 F6            	LD	P2,=BRKMSG
    1145/    F658 : 20 1D F5            	JSR	STROUT
    1146/    F65B : 20 E6 F4            	JSR	RDUMP
    1147/    F65E : 24 2E F0            	JMP	WSTART
    1148/    F661 :                     
    1149/    F661 : =>FALSE              	ELSE			; USE_REGCMD
    1150/    F661 :                     
    1151/    F661 :                     	RET
    1152/    F661 :                     
    1153/    F661 : [1125]               	ENDIF			; USE_REGCMD
    1154/    F661 :                     
    1155/    F661 :                     ;;; Data area
    1156/    F661 :                     
    1157/    F661 :                     OPNMSG:
    1158/    F661 : 0D 0A 55 6E 69 76   	DB	CR,LF,"Universal Monitor INS8070",CR,LF,0x00
             F667 : 65 72 73 61 6C 20 
             F66D : 4D 6F 6E 69 74 6F 
             F673 : 72 20 49 4E 53 38 
             F679 : 30 37 30 0D 0A 00 
    1159/    F67F :                     PROMPT:
    1160/    F67F : 5D 20 00            	DB	"] ",0x00
    1161/    F682 :                     
    1162/    F682 :                     IHEMSG:
    1163/    F682 : 45 72 72 6F 72 20   	DB	"Error ihex",CR,LF,0x00
             F688 : 69 68 65 78 0D 0A 
             F68E : 00                
    1164/    F68F :                     SHEMSG:
    1165/    F68F : 45 72 72 6F 72 20   	DB	"Error srec",CR,LF,0x00
             F695 : 73 72 65 63 0D 0A 
             F69B : 00                
    1166/    F69C :                     ERRMSG:
    1167/    F69C : 45 72 72 6F 72 0D   	DB	"Error",CR,LF,0x00
             F6A2 : 0A 00             
    1168/    F6A4 :                     
    1169/    F6A4 :                     DSEP0:
    1170/    F6A4 : 20 3A 00            	DB	" :",0x00
    1171/    F6A7 :                     DSEP1:
    1172/    F6A7 : 20 3A 20 00         	DB	" : ",0x00
    1173/    F6AB :                     IHEXER:
    1174/    F6AB : 3A 30 30 30 30 30           DB	":00000001FF",CR,LF,0x00
             F6B1 : 30 30 31 46 46 0D 
             F6B7 : 0A 00             
    1175/    F6B9 :                     SRECER:
    1176/    F6B9 : 53 39 30 33 30 30           DB	"S9030000FC",CR,LF,0x00
             F6BF : 30 30 46 43 0D 0A 
             F6C5 : 00                
    1177/    F6C6 :                     
    1178/    F6C6 :                     BRKMSG:
    1179/    F6C6 : 42 52 45 41 4B 0D   	DB	"BREAK",CR,LF,0x00
             F6CC : 0A 00             
    1180/    F6CE :                     
    1181/    F6CE : =>TRUE               	IF USE_REGCMD
    1182/    F6CE :                     
    1183/    F6CE :                     RDTAB:
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 22 - 01/27/23 00:33:42


    1184/    F6CE : F6 F6 DF 1F         	DW	RDSEA,  WORK_REGEA
    1185/    F6D2 : 02                  	DB	2
    1186/    F6D3 : FA F6 E1 1F         	DW	RDST,   WORK_REGT
    1187/    F6D7 : 02                  	DB	2
    1188/    F6D8 : FE F6 E3 1F         	DW	RDSS,   WORK_REGS
    1189/    F6DC : 01                  	DB	1
    1190/    F6DD : 02 F7 E4 1F         	DW	RDSPC,  WORK_REGPC
    1191/    F6E1 : 02                  	DB	2
    1192/    F6E2 : 08 F7 E6 1F         	DW	RDSSP,  WORK_REGSP
    1193/    F6E6 : 02                  	DB	2
    1194/    F6E7 : 0D F7 E8 1F         	DW	RDSP2,  WORK_REGP2
    1195/    F6EB : 02                  	DB	2
    1196/    F6EC : 12 F7 EA 1F         	DW	RDSP3,  WORK_REGP3
    1197/    F6F0 : 02                  	DB	2
    1198/    F6F1 :                     
    1199/    F6F1 : 00 00 00 00         	DW	0x0000, 0x0000
    1200/    F6F5 : 00                  	DB	0
    1201/    F6F6 :                     
    1202/    F6F6 : 45 41 3D 00         RDSEA:	DB	"EA=",0x00
    1203/    F6FA : 20 54 3D 00         RDST:	DB	" T=",0x00
    1204/    F6FE : 20 53 3D 00         RDSS:	DB	" S=",0x00
    1205/    F702 : 20 20 50 43 3D 00   RDSPC:	DB	"  PC=",0x00
    1206/    F708 : 20 53 50 3D 00      RDSSP:	DB	" SP=",0x00
    1207/    F70D : 20 50 32 3D 00      RDSP2:	DB	" P2=",0x00
    1208/    F712 : 20 50 33 3D 00      RDSP3:	DB	" P3=",0x00
    1209/    F717 :                     
    1210/    F717 :                     RNTAB:
    1211/    F717 : 41 01               	DB	'A',1		; "A"
    1212/    F719 : DF 1F 67 F7         	DW	WORK_REGEA,RNA
    1213/    F71D : 45 0F               	DB	'E',0x0F	; "E?"
    1214/    F71F : 37 F7 00 00         	DW	RNTABE,0
    1215/    F723 : 50 0F               	DB	'P',0x0F	; "P?"
    1216/    F725 : 45 F7 00 00         	DW	RNTABP,0
    1217/    F729 : 53 0F               	DB	'S',0x0F	; "S?"
    1218/    F72B : 59 F7 00 00         	DW	RNTABS,0
    1219/    F72F : 54 02               	DB	'T',2		; "A"
    1220/    F731 : E1 1F 7C F7         	DW	WORK_REGT,RNT
    1221/    F735 :                     
    1222/    F735 : 00 00               	DB	0x00,0
    1223/    F737 :                     
    1224/    F737 :                     RNTABE:
    1225/    F737 : 00 01               	DB	0x00,1		; "E"
    1226/    F739 : E0 1F 69 F7         	DW	WORK_REGEA+1,RNE
    1227/    F73D : 41 02               	DB	'A',2		; "EA"
    1228/    F73F : DF 1F 6B F7         	DW	WORK_REGEA,RNEA
    1229/    F743 :                     
    1230/    F743 : 00 00               	DB	0x00,0
    1231/    F745 :                     
    1232/    F745 :                     RNTABP:
    1233/    F745 : 32 02               	DB	'2',2		; "P2"
    1234/    F747 : E8 1F 6E F7         	DW	WORK_REGP2,RNP2
    1235/    F74B : 33 02               	DB	'3',2		; "P3"
    1236/    F74D : EA 1F 71 F7         	DW	WORK_REGP3,RNP3
    1237/    F751 : 43 02               	DB	'C',2		; "PC"
    1238/    F753 : E4 1F 74 F7         	DW	WORK_REGPC,RNPC
    1239/    F757 :                     
    1240/    F757 : 00 00               	DB	0x00,0
    1241/    F759 :                     
    1242/    F759 :                     RNTABS:
    1243/    F759 : 00 01               	DB	0x00,1		; "S"
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 23 - 01/27/23 00:33:42


    1244/    F75B : E3 1F 77 F7         	DW	WORK_REGS,RNS
    1245/    F75F : 50 02               	DB	'P',2		; "SP"
    1246/    F761 : E6 1F 79 F7         	DW	WORK_REGSP,RNSP
    1247/    F765 :                     
    1248/    F765 : 00 00               	DB	0x00,0
    1249/    F767 :                     
    1250/    F767 : 41 00               RNA:	DB	"A",0x00
    1251/    F769 : 45 00               RNE:	DB	"E",0x00
    1252/    F76B : 45 41 00            RNEA:	DB	"EA",0x00
    1253/    F76E : 50 32 00            RNP2:	DB	"P2",0x00
    1254/    F771 : 50 33 00            RNP3:	DB	"P3",0x00
    1255/    F774 : 50 43 00            RNPC:	DB	"PC",0x00
    1256/    F777 : 53 00               RNS:	DB	"S",0x00
    1257/    F779 : 53 50 00            RNSP:	DB	"SP",0x00
    1258/    F77C : 54 00               RNT:	DB	"T",0x00
    1259/    F77E :                     
    1260/    F77E : [1181]               	ENDIF			; USE_REGCMD
    1261/    F77E :                     
    1262/    F77E :                     ;;; Console drivers
    1263/    F77E :                     
    1264/    F77E : =>FALSE              	IF USE_DEV_EMILY
    1265/    F77E :                     	INCLUDE	"dev/dev_emily.asm"
    1266/    F77E : [1264]               	ENDIF
    1267/    F77E :                     
    1268/    F77E : =>TRUE               	IF USE_DEV_INS8073
    1269/    F77E :                     	INCLUDE	"dev/dev_ins8073.asm"
(1)    1/    F77E :                     ;;;
(1)    2/    F77E :                     ;;;	INS8073 Console Driver  (Use routines in NSC Tiny BASIC ROM)
(1)    3/    F77E :                     ;;;
(1)    4/    F77E :                     
(1)    5/    F77E :                     INIT:
(1)    6/    F77E : 5C                  	RET
(1)    7/    F77F :                     
(1)    8/    F77F :                     CONIN:
(1)    9/    F77F : 20 2A 09            	JSR	0x092B
(1)   10/    F782 : 6C FB               	BZ	CONIN
(1)   11/    F784 :                     
(1)   12/    F784 : 23 EC 1F            	PLI	P3,=DEVMEM
(1)   13/    F787 : CB 00               	ST	A,0,P3
(1)   14/    F789 : 5F                  	POP	P3
(1)   15/    F78A :                     
(1)   16/    F78A : 5C                  	RET
(1)   17/    F78B :                     
(1)   18/    F78B :                     CONST:
(1)   19/    F78B : C4 FF               	LD	A,=0xFF
(1)   20/    F78D : 5C                  	RET
(1)   21/    F78E :                     
(1)   22/    F78E :                     CONOUT:
(1)   23/    F78E : 23 EC 1F            	PLI	P3,=DEVMEM
(1)   24/    F791 : 0A                  	PUSH	A
(1)   25/    F792 : FB 00               	SUB	A,0,P3
(1)   26/    F794 : 7C 03               	BNZ	CO0
(1)   27/    F796 : 38                  	POP	A
(1)   28/    F797 : 74 02               	BRA	CO1
(1)   29/    F799 :                     CO0:
(1)   30/    F799 : 38                  	POP	A
(1)   31/    F79A : 17                  	CALL	7
(1)   32/    F79B :                     CO1:
(1)   33/    F79B : C4 00               	LD	A,=0
(1)   34/    F79D : CB 00               	ST	A,0,P3
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm(dev_ins8073.asm) - Page 24 - 01/27/23 00:33:42


(1)   35/    F79F : 5F                  	POP	P3
(1)   36/    F7A0 :                     
(1)   37/    F7A0 : 5C                  	RET
(1)   38/    F7A1 :                     
    1270/    F7A1 : [1268]               	ENDIF
    1271/    F7A1 :                     
    1272/    F7A1 :                     ;;; Entry point from NSC Tiny BASIC
    1273/    F7A1 :                     
    1274/    F7A1 : =>FALSE              	IF CONSOLE_FOR_BASIC
    1275/    F7A1 :                     
    1276/    F7A1 :                     BAS_CONIN:
    1277/    F7A1 :                     	JSR	CONST
    1278/    F7A1 :                     	BZ	BCIN0
    1279/    F7A1 :                     
    1280/    F7A1 :                     	JSR	CONIN
    1281/    F7A1 :                     	AND	A,=0x7F
    1282/    F7A1 :                     	PUSH	A
    1283/    F7A1 :                     	JSR	CONOUT
    1284/    F7A1 :                     	POP	A
    1285/    F7A1 :                     BCIN0:
    1286/    F7A1 :                     	RET
    1287/    F7A1 :                     
    1288/    F7A1 :                     BAS_CONOUT:
    1289/    F7A1 :                     	AND	A,=0x7F
    1290/    F7A1 :                     	JMP	CONOUT
    1291/    F7A1 :                     
    1292/    F7A1 :                     	ORG	0xFD00
    1293/    F7A1 :                     
    1294/    F7A1 :                     	DB	0x00		; FD00
    1295/    F7A1 :                     	DW	BAS_CONIN	; FD01,FD02
    1296/    F7A1 :                     	DW	BAS_CONOUT	; FD03,FD04
    1297/    F7A1 :                     
    1298/    F7A1 : [1274]               	ENDIF
    1299/    F7A1 :                     
    1300/    F7A1 : =>TRUE               	IF USE_DEV_INS8073
    1301/    F7A1 :                     
    1302/    FD00 :                     	ORG	0xFD00
    1303/    FD00 :                     
    1304/    FD00 : 80                  	DB	0x80		; FD00
    1305/    FD01 :                     
    1306/    FD01 : [1300]               	ENDIF
    1307/    FD01 :                     
    1308/    FD01 :                     ;;;
    1309/    FD01 :                     ;;; RAM area
    1310/    FD01 :                     ;;;
    1311/    FD01 :                     
    1312/    FD01 :                     	;; Work area
    1313/    FD01 :                     
    1314/    1FC0 :                     	ORG	WORK_B
    1315/    1FC0 :                     
    1316/       0 :                     W	STRUCT	NOEXTNAMES
    1317/       0 :                     	
    1318/       0 :                     INBUF:	DS	BUFLEN		; Line input buffer
    1319/      10 :                     DSADDR:	DS	2		; Dump start address
    1320/      12 :                     DEADDR:	DS	2		; Dump end address
    1321/      14 :                     DSTATE:	DS	1		; Dump state
    1322/      15 :                     GADDR:	DS	2		; Go address
    1323/      17 :                     SADDR:	DS	2		; Set address
    1324/      19 :                     HEXMOD:	DS	1		; HEX file mode
    1325/      1A :                     
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 25 - 01/27/23 00:33:42


    1326/      1A :                     VAL:	DS	2		; Generic 16bit value
    1327/      1C :                     CNT:	DS	1		; Generic Counter
    1328/      1D :                     SUM:	DS	1		; Checksum
    1329/      1E :                     RECTYP:	DS	1		; Record type
    1330/      1F :                     
    1331/      1F : =>TRUE               	IF USE_REGCMD
    1332/      1F :                     
    1333/      1F :                     REGEA:	DS	2
    1334/      21 :                     REGT:	DS	2
    1335/      23 :                     REGS:	DS	1
    1336/      24 :                     REGPC:	DS	2
    1337/      26 :                     REGSP:	DS	2
    1338/      28 :                     REGP2:	DS	2
    1339/      2A :                     REGP3:	DS	2
    1340/      2C :                     
    1341/      2C : [1331]               	ENDIF			; USE_REGCMD
    1342/      2C :                     
    1343/    1FC0 : =0x2C                W	ENDSTRUCT
    1344/    1FC0 :                     
    1345/    1FC0 : (STRUCT)             WORK	W
    1346/    1FEC :                     
    1347/    1FEC : =>DEFINED            	IFDEF MEMREQ
    1348/    1FEC :                     DEVMEM:	DS	MEMREQ
    1349/    1FED : [1347]               	ENDIF
    1350/    1FED :                     
    1351/    1FED :                     	END
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 26 - 01/27/23 00:33:42


  Symbol Table (* = unused):
  --------------------------

*ARCHITECTURE :                                      "x86_64-unknown-linux" - |
*BREAK :                       F63C C |  BRKMSG :                      F6C6 C |
 BS :                             8 - |  BUFLEN :                        10 - |
*CASESENSITIVE :                  0 - |  CO0 :                         F799 C |
 CO1 :                         F79B C | *COMPMODE :                       0 - |
 CONIN :                       F77F C |  CONOUT :                      F78E C |
 CONSOLE_FOR_BASIC :              0 - |  CONST :                       F78B C |
*CONSTPI :        3.141592653589793 - |  CR :                             D - |
 CRLF :                        F57A C |  CSTART :                      F004 C |
*DATE :                  "01/27/23" - |  DEL :                           7F - |
 DEVMEM :                      1FEC C |  DP0 :                         F09E C |
 DP00 :                        F095 C |  DP1 :                         F0B1 C |
 DP1E :                        F0CD C |  DPB :                         F147 C |
 DPB0 :                        F158 C |  DPB1 :                        F174 C |
 DPB2 :                        F178 C |  DPBE :                        F19D C |
 DPL :                         F0FB C |  DPL0 :                        F115 C |
 DPL1 :                        F12A C |  DPL2 :                        F130 C |
 DPL3 :                        F134 C |  DPL4 :                        F13C C |
 DPM :                         F0D0 C |  DPM0 :                        F0D9 C |
 DPM01 :                       F0EB C |  DPM1 :                        F0F2 C |
 DSEP0 :                       F6A4 C |  DSEP1 :                       F6A7 C |
*DUMMY :                       F63B C |  DUMP :                        F082 C |
 ERR :                         F079 C |  ERRMSG :                      F69C C |
*FALSE :                          0 - |  FOR_INS8073 :                    1 - |
*FULLPMMU :                       1 - |  G0 :                          F1B8 C |
 GETLIN :                      F584 C |  GL0 :                         F58B C |
 GL1 :                         F5A0 C |  GL2 :                         F5C5 C |
 GL3 :                         F5CC C |  GLB :                         F5AA C |
 GLE :                         F598 C |  GO :                          F19E C |
 GO0 :                         F1B0 C | *HAS64 :                          1 - |
*HASFPU :                         0 - | *HASPMMU :                        0 - |
 HEXIN :                       F546 C |  HEXOUT0 :                     F541 C |
 HEXOUT1 :                     F531 C |  HEXOUT2 :                     F528 C |
 HEXOUTE :                     F53C C |  HI0 :                         F54F C |
 HI1 :                         F56C C |  HI2 :                         F571 C |
 HI3 :                         F574 C |  HIR :                         F56A C |
 IHEMSG :                      F682 C |  IHEXER :                      F6AB C |
 INIT :                        F77E C | *INSUPMODE :                      0 - |
 LF :                             A - |  LH0 :                         F25E C |
*LH1 :                         F269 C |  LH2 :                         F26E C |
 LH3 :                         F278 C |  LHE :                         F27E C |
 LHI0 :                        F281 C |  LHI1 :                        F2AF C |
 LHI2 :                        F2BE C |  LHI3 :                        F2C2 C |
 LHIE :                        F2D0 C |  LHS0 :                        F2D9 C |
 LHS01 :                       F2EC C |  LHS02 :                       F2F0 C |
 LHS1 :                        F311 C |  LHS2 :                        F320 C |
 LHS3 :                        F324 C |  LHSE :                        F334 C |
 LHSR :                        F33A C | *LISTON :                         1 - |
 LOADH :                       F24F C |  M00 :                         F04B C |
 M01 :                         F053 C |  M02 :                         F05B C |
 M03 :                         F063 C |  M04 :                         F06B C |
 M05 :                         F073 C |  M09 :                         F079 C |
*MACEXP :                         7 - |  MEMREQ :                         1 - |
*MOMCPU :                      8070 - | *MOMCPUNAME :                "8070" - |
*NESTMAX :                      100 - |  OPNMSG :                      F661 C |
*PADDING :                        1 - |  PROMPT :                      F67F C |
 RAM_B :                       1800 - |  RD0 :                         F4EA C |
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 27 - 01/27/23 00:33:42


 RD1 :                         F50A C |  RDHEX :                       F5FC C |
 RDR :                         F51B C |  RDSEA :                       F6F6 C |
 RDSP2 :                       F70D C |  RDSP3 :                       F712 C |
 RDSPC :                       F702 C |  RDSS :                        F6FE C |
 RDSSP :                       F708 C |  RDST :                        F6FA C |
 RDTAB :                       F6CE C |  RDUMP :                       F4E7 C |
 REG :                         F44C C | *RELAXED :                        0 - |
 RG0 :                         F45C C |  RG1 :                         F45F C |
 RG2 :                         F46D C |  RG3 :                         F480 C |
 RG4 :                         F4A3 C |  RG5 :                         F4B0 C |
 RG6 :                         F4D5 C |  RG7 :                         F4DA C |
 RGE :                         F4E1 C |  RGR :                         F4DE C |
 RH0 :                         F603 C |  RH01 :                        F60F C |
 RH02 :                        F617 C |  RH03 :                        F61E C |
 RH1 :                         F626 C |  RHE :                         F638 C |
 RNA :                         F767 C |  RNE :                         F769 C |
 RNEA :                        F76B C |  RNP2 :                        F76E C |
 RNP3 :                        F771 C |  RNPC :                        F774 C |
 RNS :                         F777 C |  RNSP :                        F779 C |
 RNT :                         F77C C |  RNTAB :                       F717 C |
 RNTABE :                      F737 C |  RNTABP :                      F745 C |
 RNTABS :                      F759 C |  ROM_B :                       F000 - |
 SAVEH :                       F33D C |  SETM :                        F1D3 C |
 SH0 :                         F34E C |  SH1 :                         F353 C |
 SH2 :                         F380 C |  SH3 :                         F38B C |
 SH4 :                         F3A1 C |  SHE :                         F37D C |
 SHEMSG :                      F68F C |  SHEP :                        F37C C |
 SHL :                         F3AA C |  SHL0 :                        F3BF C |
 SHL1 :                        F3C8 C |  SHLI0 :                       F3F3 C |
 SHLS :                        F40C C |  SHLS0 :                       F433 C |
 SKIPSP :                      F5E1 C |  SM0 :                         F1E5 C |
 SM1 :                         F1ED C |  SM2 :                         F221 C |
 SM3 :                         F22F C |  SM4 :                         F237 C |
 SM5 :                         F241 C |  SRECER :                      F6B9 C |
*STACK :                       1F00 - |  STROR :                       F527 C |
 STROUT :                      F51E C | *TIME :                  "00:33:42" - |
*TRUE :                           1 - |  UP0 :                         F5F1 C |
 UPPER :                       F5EA C |  UPR :                         F5FA C |
 USE_DEV_EMILY :                  0 - |  USE_DEV_INS8073 :                1 - |
 USE_REGCMD :                     1 - | *VERSION :                     142F - |
 WORK :                        1FC0 C |  WORK_B :                      1FC0 - |
*WORK_CNT :                    1FDC C | *WORK_DEADDR :                 1FD2 C |
*WORK_DSADDR :                 1FD0 C | *WORK_DSTATE :                 1FD4 C |
*WORK_GADDR :                  1FD5 C | *WORK_HEXMOD :                 1FD9 C |
 WORK_INBUF :                  1FC0 C | *WORK_RECTYP :                 1FDE C |
 WORK_REGEA :                  1FDF C |  WORK_REGP2 :                  1FE8 C |
 WORK_REGP3 :                  1FEA C |  WORK_REGPC :                  1FE4 C |
 WORK_REGS :                   1FE3 C |  WORK_REGSP :                  1FE6 C |
 WORK_REGT :                   1FE1 C | *WORK_SADDR :                  1FD7 C |
*WORK_SUM :                    1FDD C | *WORK_VAL :                    1FDA C |
 WSTART :                      F02F C |  W_CNT :                         1C - |
 W_DEADDR :                      12 - |  W_DSADDR :                      10 - |
 W_DSTATE :                      14 - |  W_GADDR :                       15 - |
 W_HEXMOD :                      19 - | *W_INBUF :                        0 - |
*W_LEN :                         2C - |  W_RECTYP :                      1E - |
 W_REGEA :                       1F - |  W_REGP2 :                       28 - |
 W_REGP3 :                       2A - |  W_REGPC :                       24 - |
 W_REGS :                        23 - |  W_REGSP :                       26 - |
 W_REGT :                        21 - |  W_SADDR :                       17 - |
 W_SUM :                         1D - |  W_VAL :                         1A - |
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 28 - 01/27/23 00:33:42



    233 symbols
     37 unused symbols

 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 29 - 01/27/23 00:33:42


  Defined Structures/Unions:
  --------------------------

W
  0          INBUF
 10          DSADDR
 12          DEADDR
 14          DSTATE
 15          GADDR
 17          SADDR
 19          HEXMOD
 1A          VAL
 1C          CNT
 1D          SUM
 1E          RECTYP
 1F          REGEA
 21          REGT
 23          REGS
 24          REGPC
 26          REGSP
 28          REGP2
 2A          REGP3
1 structure
 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 30 - 01/27/23 00:33:42


  Defined Functions:
  ------------------

HIGH                                  | LOW                                  

 AS V1.42 Beta [Bld 235] - Source File unimon_ins8070.asm - Page 31 - 01/27/23 00:33:42


  Code Pages:
  ----------

STANDARD (0 changed characters)

1 code page

0.05 seconds assembly time

   1453 lines source file
      2 passes
      0 errors
      0 warnings
